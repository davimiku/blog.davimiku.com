<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><title>Tutorial: Writing a JSON parser in Rust</title><meta name="robots" content="index,follow"/><meta name="description" content="Learn the fundamentals of lexing and parsing to build a JSON parser from scratch"/><meta property="og:title" content="Tutorial: Writing a JSON parser in Rust"/><meta property="og:description" content="Learn the fundamentals of lexing and parsing to build a JSON parser from scratch"/><meta name="next-head-count" content="14"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/5ed007d40889d5c3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5ed007d40889d5c3.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c39945f39b20cb49.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c39945f39b20cb49.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-5752944655d749a0.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-43bae646d7cb6843.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8665ada8bed8d11e.js" defer=""></script><script src="/_next/static/chunks/294-c40e0228441b11dc.js" defer=""></script><script src="/_next/static/chunks/238-5e6757d10c40234c.js" defer=""></script><script src="/_next/static/chunks/pages/blog/tutorials/json-parser-rust-cb01b321bd81eb71.js" defer=""></script><script src="/_next/static/JujsoKe1gNb9miu8P0_RH/_buildManifest.js" defer=""></script><script src="/_next/static/JujsoKe1gNb9miu8P0_RH/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400&display=swap">@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu52xM.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlvAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu51xFIzIXKMnyrYk.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu51xMIzIXKMnyrYk.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu51xEIzIXKMnyrYk.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu51xLIzIXKMnyrYk.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu51xHIzIXKMnyrYk.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu51xGIzIXKMnyrYk.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOkCnqEu92Fr1Mu51xIIzIXKMny.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next" data-reactroot=""><div class="headroom-wrapper"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translate3D(0, 0, 0);-ms-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)" class="headroom headroom--unfixed"><nav class="Header_nav__70yDD"><div><h1><a href="/">davimiku</a></h1></div><ul class="Header_nav-links__w6Ltd"><li><a class="" href="/">home</a></li><li><a class="" href="/projects">projects</a></li><li><a class="" href="/blog">blog</a></li></ul><div class="Header_theme-container__PGNgu"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2732%27%20height=%2732%27/%3e"/></span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img src="/images/header/sun.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><label class="Toggle_toggleLabel__0bMk0"><div class="react-toggle react-toggle--checked"><div class="react-toggle-track"><div class="react-toggle-track-check"></div><div class="react-toggle-track-x"></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only"/></div></label><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2732%27%20height=%2732%27/%3e"/></span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img src="/images/header/moon.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div></nav></div></div><main class="Layout_main__gmMSA Layout_main--dark__zjKmX"><article class="blog_container__mTn9i"><h1>Tutorial: Writing a JSON parser in Rust</h1><p>Learn the fundamentals of lexing and parsing to build a JSON parser from scratch</p><section><h2>Understanding the JSON syntax and types</h2>
<p>Types include</p>
<ul>
<li>object (<code>{ &quot;key&quot;: json_value }</code>)</li>
<li>array (<code>[ json_value, json_value ]</code>)</li>
<li>number (<code>2</code>, <code>-2</code>, <code>2.5</code>, <code>2E+32</code>, <code>2e-16</code>)</li>
<li>string (<code>&quot;a string&quot;</code>)</li>
<li>boolean (<code>true</code> or <code>false</code>)</li>
<li>null</li>
</ul>
<details class="Spoiler_details__gotJo"><summary class="Spoiler_summary__6Nxkr">JSON syntax is a subset of Javascript syntax</summary><div class="Spoiler_detailsContent__yhV_z"><p>As of ES2019, JSON syntax is a subset of Javascript syntax when <a href="https://github.com/tc39/proposal-json-superset">unicode characters
U+2028 and U+2029</a> are allowed to exist in JS strings unescaped.</p><p>JSON is not necessarily a <strong>semantic</strong> subset of Javascript. For example, the following produces a different result when
parsed as Javascript vs. JSON.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[{ &quot;__proto__&quot;: [] }]</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> fromJS <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token keyword">const</span> fromJSON <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre><p>The <code>fromJS</code> result is an array with one item, where that item is an Object that has Array as its prototype.
The <code>fromJSON</code> result is also an array with one item, and that item is an Object who has an own property with
an identifier of <code>__proto__</code> (compare the result of <code>Object.getOwnPropertyNames(x)</code> for each <code>fromJS</code> and <code>fromJSON</code>).</p></div></details>
<h3>Defining the types for JSON values</h3>
<p>Start with the easy values, the primitives:</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Value</span> <span class="token punctuation">{</span>
  <span class="token comment">/// literal characters `null`</span>
  <span class="token class-name">Null</span><span class="token punctuation">,</span>

  <span class="token comment">/// literal characters `true` or `false`</span>
  <span class="token class-name">Bool</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// characters within double quotes &quot;...&quot;</span>
  <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Add on the non-primitives:</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Value</span> <span class="token punctuation">{</span>
  <span class="token comment">/// literal characters `null`</span>
  <span class="token class-name">Null</span><span class="token punctuation">,</span>

  <span class="token comment">/// literal characters `true` or `false`</span>
  <span class="token class-name">Bool</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// characters within double quotes &quot;...&quot;</span>
  <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// Zero to many JSON values in an array</span>
  <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Value</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// Key/value pairs</span>
  <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token class-name">BTreeMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Value</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Quiz: Which value is missing?</p>
<p>Number is not quite straightforward in Rust, the available types are more granular. While the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Number in Javascript</a> (and JSON!)
represents a <code>double</code> value, or in other words a 64-bit floating value as described in <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a>.</p>
<p>For our purposes, we will explore how to capture JSON numbers in two ways, as an integer <code>i64</code> and as a floating value <code>f64</code>.</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Number</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Number without a fractional component</span>
  <span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token keyword">i64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// Number that has a fractional component</span>
  <span class="token class-name">Float</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Finally, add this enum to our overall <code>Value</code> enum.</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Value</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...snip...</span>

  <span class="token comment">/// Number value</span>
  <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h2>Writing the Lexer</h2>
<h3>Creating the Token type</h3>
<pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug, PartialEq, Clone)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">TokenKind</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Literals</span>
    <span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token keyword">i64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Float</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Null</span><span class="token punctuation">,</span>
    <span class="token class-name">Bool</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/// Key of the key/value pair or string value</span>
    <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/// Punctuation</span>
    <span class="token class-name">LeftBrace</span><span class="token punctuation">,</span>
    <span class="token class-name">RightBrace</span><span class="token punctuation">,</span>
    <span class="token class-name">LeftBracket</span><span class="token punctuation">,</span>
    <span class="token class-name">RightBracket</span><span class="token punctuation">,</span>
    <span class="token class-name">Comma</span><span class="token punctuation">,</span>
    <span class="token class-name">Colon</span><span class="token punctuation">,</span>

    <span class="token constant">EOF</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>OPTIONAL: Implement <code>Display</code> for the Token.
This will allow having a custom format for printing the token out, which can be useful for debugging.</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">example_print</span><span class="token punctuation">(</span>token<span class="token punctuation">:</span> <span class="token class-name">Token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Requires `Display` to be implemented for Token</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Requires `Debug` to be implemented for Token, which can be derived automatically</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span>

<span class="token comment">// ...snip...</span>

<span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">TokenKind</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">FmtResult</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">LeftBracket</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char">&#x27;[&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">RightBracket</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char">&#x27;]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">LeftBrace</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char">&#x27;{&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">RightBrace</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char">&#x27;}&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Comma</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char">&#x27;,&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Colon</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char">&#x27;:&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">String</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Int</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Float</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Bool</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Null</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_str</span><span class="token punctuation">(</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token constant">EOF</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_str</span><span class="token punctuation">(</span><span class="token string">&quot;EOF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">Token</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span>
        f<span class="token punctuation">.</span><span class="token function">write_fmt</span><span class="token punctuation">(</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span>
            <span class="token string">&quot;token &#x27;{}&#x27; at row {}, col {}&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>kind<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>location<span class="token punctuation">.</span>row<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>location<span class="token punctuation">.</span>col<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<h3>Rust Traits: The <code>Iterator</code></h3>
<p>We&#x27;ll first start be defining the <code>struct</code> for the Lexer, which will take the character input and output our <code>Token</code>s.</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Lexer</span><span class="token operator">&lt;</span><span class="token class-name">I</span><span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">char</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Iterator for chars from the input</span>
  char_iter<span class="token punctuation">:</span> <span class="token class-name">I</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>At first, this syntax can be confusing without much experience with Rust or other languages with generics. In this case, <code>I</code> represents
a generic type parameter which can be anything is an <code>Iterator</code> for <code>char</code>acters.</p>
<p>A more explicit (and semantically equivalent) way of writing this is below.</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Lexer</span><span class="token operator">&lt;</span><span class="token class-name">I</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">I</span><span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token comment">/// Iterator for chars from the input</span>
  char_iter<span class="token punctuation">:</span> <span class="token class-name">I</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We&#x27;ll want a few other fields in the lexer.</p>
<pre class="language-rust"><code class="language-rust"><span class="token comment">/// The Lexer produces tokens from the character input</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Lexer</span><span class="token operator">&lt;</span><span class="token class-name">I</span><span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">char</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Iterator for chars from the input</span>
    char_iter<span class="token punctuation">:</span> <span class="token class-name">I</span><span class="token punctuation">,</span>

    <span class="token comment">/// Current Location (row/col) of the lexer in the input</span>
    location<span class="token punctuation">:</span> <span class="token class-name">Location</span><span class="token punctuation">,</span>

    <span class="token comment">/// The current character in the iterator</span>
    curr<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>

    <span class="token comment">/// The next character in the iterator</span>
    next<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h2>Writing the Parser</h2>
<h2>The nitty gritty</h2>
<h3>Objects with duplicate keys</h3>
<p>The RFC specifies that the names within an object SHOULD be unique,
https://datatracker.ietf.org/doc/html/rfc8259</p>
<blockquote>
<p>An object whose names are all unique is interoperable in the sense
that all software implementations receiving that object will agree on
the name-value mappings. When the names within an object are not
unique, the behavior of software that receives such an object is
unpredictable. Many implementations report the last name/value pair
only. Other implementations report an error or fail to parse the
object, and some implementations report all of the name/value pairs,
including duplicates.</p>
</blockquote>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{&quot;a&quot;: 1, &quot;a&quot;: 2}</span><span class="token template-punctuation string">`</span></span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; { a: 2 }</span>
</code></pre>
<h3>Object Key Ordering</h3></section></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/tutorials/json-parser-rust","query":{},"buildId":"JujsoKe1gNb9miu8P0_RH","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>