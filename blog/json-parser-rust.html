<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><title>Writing a JSON parser in Rust</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Learn the fundamentals of lexing and parsing to build a JSON parser from scratch"/><meta name="next-head-count" content="10"/><link rel="preload" href="/_next/static/css/6e4e91e043dae7b110a9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e4e91e043dae7b110a9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/79354143dd4e8bf55f8d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/79354143dd4e8bf55f8d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-28654a8145d7603786fc.js"></script><script src="/_next/static/chunks/webpack-7e827f325576e682ac28.js" defer=""></script><script src="/_next/static/chunks/framework.6fff953eb0f638171baa.js" defer=""></script><script src="/_next/static/chunks/commons.da709f74f42bc0f283a2.js" defer=""></script><script src="/_next/static/chunks/main-bb051706677cf41367d5.js" defer=""></script><script src="/_next/static/chunks/pages/_app-41ab3b8f4a71fc29683e.js" defer=""></script><script src="/_next/static/chunks/4b8647bce55396fdb06b3a428fb06d089a34d4b7.872bc19ec5b55c376487.js" defer=""></script><script src="/_next/static/chunks/pages/blog/json-parser-rust-a10e090564348e4c88c5.js" defer=""></script><script src="/_next/static/ruQPKaWuanuu0HMCSLlbn/_buildManifest.js" defer=""></script><script src="/_next/static/ruQPKaWuanuu0HMCSLlbn/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="headroom-wrapper"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translate3D(0, 0, 0);-ms-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)" class="headroom headroom--unfixed"><nav class="Header_nav__39SXP"><div><h1><a href="/">davimiku</a></h1></div><ul class="Header_nav-links__jHBhP"><li><a class="" href="/">home</a></li><li><a class="" href="/projects">projects</a></li><li><a class="" href="/blog">blog</a></li></ul><div class="Header_theme-container__3ekx3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 302.4 302.4"><path d="M204.8 97.6C191.2 84 172 75.2 151.2 75.2s-40 8.4-53.6 22.4c-13.6 13.6-22.4 32.8-22.4 53.6s8.8 40 22.4 53.6c13.6 13.6 32.8 22.4 53.6 22.4s40-8.4 53.6-22.4c13.6-13.6 22.4-32.8 22.4-53.6s-8.4-40-22.4-53.6zm-14.4 92.8c-10 10-24 16-39.2 16s-29.2-6-39.2-16-16-24-16-39.2 6-29.2 16-39.2 24-16 39.2-16 29.2 6 39.2 16 16 24 16 39.2-6 29.2-16 39.2zM292 140.8h-30.8c-5.6 0-10.4 4.8-10.4 10.4 0 5.6 4.8 10.4 10.4 10.4H292c5.6 0 10.4-4.8 10.4-10.4 0-5.6-4.8-10.4-10.4-10.4zM151.2 250.8c-5.6 0-10.4 4.8-10.4 10.4V292c0 5.6 4.8 10.4 10.4 10.4 5.6 0 10.4-4.8 10.4-10.4v-30.8c0-5.6-4.8-10.4-10.4-10.4zM258 243.6l-22-22c-3.6-4-10.4-4-14.4 0s-4 10.4 0 14.4l22 22c4 4 10.4 4 14.4 0s4-10.4 0-14.4zM151.2 0c-5.6 0-10.4 4.8-10.4 10.4v30.8c0 5.6 4.8 10.4 10.4 10.4 5.6 0 10.4-4.8 10.4-10.4V10.4c0-5.6-4.8-10.4-10.4-10.4zM258.4 44.4c-4-4-10.4-4-14.4 0l-22 22c-4 4-4 10.4 0 14.4 3.6 4 10.4 4 14.4 0l22-22c4-4 4-10.4 0-14.4zM41.2 140.8H10.4c-5.6 0-10.4 4.8-10.4 10.4s4.4 10.4 10.4 10.4h30.8c5.6 0 10.4-4.8 10.4-10.4 0-5.6-4.8-10.4-10.4-10.4zM80.4 221.6c-3.6-4-10.4-4-14.4 0l-22 22c-4 4-4 10.4 0 14.4s10.4 4 14.4 0l22-22c4-4 4-10.4 0-14.4zM80.4 66.4l-22-22c-4-4-10.4-4-14.4 0s-4 10.4 0 14.4l22 22c4 4 10.4 4 14.4 0s4-10.4 0-14.4z"></path></svg><label class="Toggle_toggleLabel__qFFi1"><div class="react-toggle react-toggle--checked"><div class="react-toggle-track"><div class="react-toggle-track-check"></div><div class="react-toggle-track-x"></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only"/></div></label><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 312.999 312.999"><path d="M305.6 178.053c-3.2-.8-6.4 0-9.2 2-10.4 8.8-22.4 16-35.6 20.8-12.4 4.8-26 7.2-40.4 7.2-32.4 0-62-13.2-83.2-34.4-21.2-21.2-34.4-50.8-34.4-83.2 0-13.6 2.4-26.8 6.4-38.8 4.4-12.8 10.8-24.4 19.2-34.4 3.6-4.4 2.8-10.8-1.6-14.4-2.8-2-6-2.8-9.2-2-34 9.2-63.6 29.6-84.8 56.8-20.4 26.8-32.8 60-32.8 96.4 0 43.6 17.6 83.2 46.4 112s68.4 46.4 112 46.4c36.8 0 70.8-12.8 98-34 27.6-21.6 47.6-52.4 56-87.6 2-6-1.2-11.6-6.8-12.8zm-61.2 83.6c-23.2 18.4-52.8 29.6-85.2 29.6-38 0-72.4-15.6-97.2-40.4-24.8-24.8-40.4-59.2-40.4-97.2 0-31.6 10.4-60.4 28.4-83.6 12.4-16 28-29.2 46-38.4-2 4.4-4 8.8-5.6 13.6-5.2 14.4-7.6 29.6-7.6 45.6 0 38 15.6 72.8 40.4 97.6s59.6 40.4 97.6 40.4c16.8 0 32.8-2.8 47.6-8.4 5.2-2 10.4-4 15.2-6.4-9.6 18.4-22.8 34.8-39.2 47.6z"></path></svg></div></nav></div></div><main class="Layout_main__27ZHg Layout_main--dark__uLgSe"><article class="blog_container__lN3sd"><h1>Writing a JSON parser in Rust</h1><p>Learn the fundamentals of lexing and parsing to build a JSON parser from scratch</p><section><h2>Understanding the JSON syntax and types</h2><p>Types include</p><ul><li>object (<code>{ &quot;key&quot;: json_value }</code>)</li><li>array (<code>[ json_value, json_value ]</code>)</li><li>number (<code>2</code>, <code>-2</code>, <code>2.5</code>, <code>2E+32</code>, <code>2e-16</code>)</li><li>string (<code>&quot;a string&quot;</code>)</li><li>boolean (<code>true</code> or <code>false</code>)</li><li>null</li></ul><details class="Spoiler_details__dpHhE"><summary class="Spoiler_summary__2kaZH">JSON syntax is a subset of Javascript syntax</summary><div class="Spoiler_detailsContent__18Z1p"><p>As of ES2019, JSON syntax is a subset of Javascript syntax when <a href="https://github.com/tc39/proposal-json-superset">unicode characters
U+2028 and U+2029</a> are allowed to exist in JS strings unescaped.</p><p>JSON is not necessarily a <strong>semantic</strong> subset of Javascript. For example, the following produces a different result when
parsed as Javascript vs. JSON.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[{ &quot;__proto__&quot;: [] }]</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> fromJS <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token keyword">const</span> fromJSON <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre><p>The <code>fromJS</code> result is an array with one item, where that item is an Object that has Array as its prototype.
The <code>fromJSON</code> result is also an array with one item, and that item is an Object who has an own property with
an identifier of <code>__proto__</code> (compare the result of <code>Object.getOwnPropertyNames(x)</code> for each <code>fromJS</code> and <code>fromJSON</code>).</p></div></details><h3>Defining the types for JSON values</h3><p>Start with the easy values, the primitives:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Value</span> <span class="token punctuation">{</span>
  <span class="token comment">/// literal characters `null`</span>
  <span class="token class-name">Null</span><span class="token punctuation">,</span>

  <span class="token comment">/// literal characters `true` or `false`</span>
  <span class="token class-name">Bool</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// characters within double quotes &quot;...&quot;</span>
  <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>Add on the non-primitives:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Value</span> <span class="token punctuation">{</span>
  <span class="token comment">/// literal characters `null`</span>
  <span class="token class-name">Null</span><span class="token punctuation">,</span>

  <span class="token comment">/// literal characters `true` or `false`</span>
  <span class="token class-name">Bool</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// characters within double quotes &quot;...&quot;</span>
  <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// Zero to many JSON values in an array</span>
  <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Value</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// Key/value pairs</span>
  <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token class-name">BTreeMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Value</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>Quiz: Which value is missing?</p><p>Number is not quite straightforward in Rust, the available types are more granular. While the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Number in Javascript</a> (and JSON!)
represents a <code>double</code> value, or in other words a 64-bit floating value as described in <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a>.</p><p>For our purposes, we will explore how to capture JSON numbers in two ways, as an integer <code>i64</code> and as a floating value <code>f64</code>.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Number</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Number without a fractional component</span>
  <span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token keyword">i64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">/// Number that has a fractional component</span>
  <span class="token class-name">Float</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>Finally, add this enum to our overall <code>Value</code> enum.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Value</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token comment">/// Number value</span>
  <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><h2>Writing the Lexer</h2><h3>Creating the Token type</h3><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug, PartialEq, Clone)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">TokenKind</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Literals</span>
    <span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token keyword">i64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Float</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Null</span><span class="token punctuation">,</span>
    <span class="token class-name">Bool</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/// Key of the key/value pair or string value</span>
    <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/// Punctuation</span>
    <span class="token class-name">LeftBrace</span><span class="token punctuation">,</span>
    <span class="token class-name">RightBrace</span><span class="token punctuation">,</span>
    <span class="token class-name">LeftBracket</span><span class="token punctuation">,</span>
    <span class="token class-name">RightBracket</span><span class="token punctuation">,</span>
    <span class="token class-name">Comma</span><span class="token punctuation">,</span>
    <span class="token class-name">Colon</span><span class="token punctuation">,</span>

    <span class="token constant">EOF</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>OPTIONAL: Implement <code>Display</code> for the Token.
This will allow having a custom format for printing the token out, which can be useful for debugging.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">example_print</span><span class="token punctuation">(</span>token<span class="token punctuation">:</span> <span class="token class-name">Token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Requires `Display` to be implemented for Token</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Requires `Debug` to be implemented for Token, which can be derived automatically</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-rust"><code class="language-rust"><span class="token comment">// Note &quot;Result as FmtResult&quot;, I typically avoid shadowing the regular `Result`</span>
<span class="token comment">// enum for clarity, although it can be convenient at times.</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Display</span><span class="token punctuation">,</span> <span class="token class-name">Formatter</span><span class="token punctuation">,</span> <span class="token class-name">Result</span> <span class="token keyword">as</span> <span class="token class-name">FmtResult</span><span class="token punctuation">,</span> <span class="token class-name">Write</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token comment">//</span>
<span class="token keyword">impl</span> <span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">TokenKind</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">FmtResult</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">LeftBracket</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char string">&#x27;[&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">RightBracket</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char string">&#x27;]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">LeftBrace</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char string">&#x27;{&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">RightBrace</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char string">&#x27;}&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Comma</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char string">&#x27;,&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Colon</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_char</span><span class="token punctuation">(</span><span class="token char string">&#x27;:&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">String</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Int</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Float</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Bool</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token class-name">Null</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_str</span><span class="token punctuation">(</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">TokenKind</span><span class="token punctuation">::</span><span class="token constant">EOF</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">write_str</span><span class="token punctuation">(</span><span class="token string">&quot;EOF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">impl</span> <span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">Token</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">FmtResult</span> <span class="token punctuation">{</span>
        f<span class="token punctuation">.</span><span class="token function">write_fmt</span><span class="token punctuation">(</span><span class="token macro property">format_args!</span><span class="token punctuation">(</span>
            <span class="token string">&quot;token &#x27;{}&#x27; at row {}, col {}&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>kind<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>location<span class="token punctuation">.</span>row<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>location<span class="token punctuation">.</span>col<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h3>Rust Traits: The <code>Iterator</code></h3><p>We&#x27;ll first start be defining the <code>struct</code> for the Lexer, which will take the character input and output our <code>Token</code>s.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Lexer</span><span class="token operator">&lt;</span><span class="token class-name">I</span><span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">char</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Iterator for chars from the input</span>
  char_iter<span class="token punctuation">:</span> <span class="token class-name">I</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>At first, this syntax can be confusing without much experience with Rust or other languages with generics. In this case, <code>I</code> represents
a generic type parameter which can be anything is an <code>Iterator</code> for <code>char</code>acters.</p><p>A more explicit (and semantically equivalent) way of writing this is below.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Lexer</span><span class="token operator">&lt;</span><span class="token class-name">I</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">I</span><span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token comment">/// Iterator for chars from the input</span>
  char_iter<span class="token punctuation">:</span> <span class="token class-name">I</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>We&#x27;ll want a few other fields in the lexer.</p><pre class="language-rust"><code class="language-rust"><span class="token comment">/// The Lexer produces tokens from the character input</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Lexer</span><span class="token operator">&lt;</span><span class="token class-name">I</span><span class="token punctuation">:</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">char</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Iterator for chars from the input</span>
    char_iter<span class="token punctuation">:</span> <span class="token class-name">I</span><span class="token punctuation">,</span>

    <span class="token comment">/// Current Location (row/col) of the lexer in the input</span>
    location<span class="token punctuation">:</span> <span class="token class-name">Location</span><span class="token punctuation">,</span>

    <span class="token comment">/// The current character in the iterator</span>
    curr<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>

    <span class="token comment">/// The next character in the iterator</span>
    next<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><h2>Writing the Parser</h2><h2>The nitty gritty</h2><h3>Objects with duplicate keys</h3><p>The RFC specifies that the names within an object SHOULD be unique,
<a href="https://datatracker.ietf.org/doc/html/rfc8259">https://datatracker.ietf.org/doc/html/rfc8259</a></p><blockquote><p>An object whose names are all unique is interoperable in the sense
that all software implementations receiving that object will agree on
the name-value mappings. When the names within an object are not
unique, the behavior of software that receives such an object is
unpredictable. Many implementations report the last name/value pair
only. Other implementations report an error or fail to parse the
object, and some implementations report all of the name/value pairs,
including duplicates.</p></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{&quot;a&quot;: 1, &quot;a&quot;: 2}</span><span class="token template-punctuation string">`</span></span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; { a: 2 }</span>
</code></pre><h3>Object Key Ordering</h3></section></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/json-parser-rust","query":{},"buildId":"ruQPKaWuanuu0HMCSLlbn","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>